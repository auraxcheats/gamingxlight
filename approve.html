<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Approve Order | GAMING X LIGHT</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
(function(){ emailjs.init("Jq3n4jPZiiiwdgY7_"); })();
</script>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background: radial-gradient(circle at top, #1c1030, #0b0b0f 65%);
  color: #fff;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.container {
  width:100%;
  max-width:450px;
  background:#141414;
  padding:30px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.1);
  text-align:center;
}
.logo {
  width:120px;
  margin-bottom:20px;
}
h2,h3,p{margin:10px 0;}
button {
  margin:10px 10px 0 10px;
  padding:14px 22px;
  background:#a855f7;
  color:#000;
  border:none;
  border-radius:12px;
  font-weight:800;
  cursor:pointer;
}
button:hover{opacity:0.9}
button:disabled{opacity:.5;cursor:not-allowed}
</style>
</head>
<body>

<div class="container">
  <img src="logo.png" class="logo" alt="GAMING X LIGHT">
  <h2>Approve/Reject Order</h2>

  <p><b>Order ID:</b> <span id="orderId"></span></p>
  <p><b>Product:</b> <span id="product"></span></p>
  <p><b>Price:</b> ₹<span id="price"></span></p>
  <p><b>Guild UID:</b> <span id="uid"></span></p>
  <p><b>Customer Email:</b> <span id="email"></span></p>

  <button id="approveBtn">APPROVE</button>
  <button id="rejectBtn">REJECT</button>

  <p id="statusMsg" style="margin-top:15px;font-weight:bold;color:#00ffcc"></p>
</div>

<script>
// GET ORDER DETAILS FROM URL
const params = new URLSearchParams(window.location.search);
const orderId = params.get("order");
const product = params.get("product");
const price = params.get("price");
const uid = params.get("uid");
const email = params.get("email");

// CHECK
if(!orderId || !product || !price || !email){
  alert("❌ Invalid access!");
  document.body.innerHTML="<h2>Invalid Access</h2>";
}

// SET DATA
document.getElementById("orderId").innerText = orderId;
document.getElementById("product").innerText = decodeURIComponent(product);
document.getElementById("price").innerText = price;
document.getElementById("uid").innerText = uid || "N/A";
document.getElementById("email").innerText = email;

// APPROVE BUTTON
document.getElementById("approveBtn").addEventListener("click", async () => {
  const btn = document.getElementById("approveBtn");
  btn.disabled = true;
  document.getElementById("statusMsg").innerText = "Sending approval email...";

  const templateParams = {
    order_id: orderId,
    product: decodeURIComponent(product),
    price: price,
    email: email,
    status: "APPROVED"
  };

  try{
    await emailjs.send("service_bepfzoh", "customer_reply", templateParams);
    document.getElementById("statusMsg").innerText = "✅ Email sent to customer!";
    btn.disabled = true;
    document.getElementById("rejectBtn").disabled = true;
  }catch(err){
    console.error(err);
    document.getElementById("statusMsg").innerText = "❌ Error sending email!";
    btn.disabled = false;
  }
});

// REJECT BUTTON
document.getElementById("rejectBtn").addEventListener("click", () => {
  document.getElementById("statusMsg").innerText = "❌ Order rejected. Approve disabled.";
  document.getElementById("approveBtn").disabled = true;
  document.getElementById("rejectBtn").disabled = true;
});
</script>

</body>
</html>
