<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Payment Details | GAMING X LIGHT</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
(function(){ emailjs.init("lDpUNN_uwsW-vT8_2"); })();

const supabaseUrl = "https://dsrevynaanjmepnufzqi.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBh..."; // anon key
const supabase = supabase.createClient(supabaseUrl, supabaseKey);
</script>
<style>
body{margin:0;font-family:Arial;background:#0b0b0f;color:#fff}
.container{max-width:420px;margin:30px auto;background:#141414;padding:22px;border-radius:16px;border:1px solid rgba(255,255,255,.1)}
input,select,button{width:100%;padding:14px;margin-bottom:14px;border-radius:10px;border:none;font-size:14px;color:#fff;background:#0f0f0f}
button{background:#a855f7;color:#000;font-weight:800;cursor:pointer}
button:disabled{opacity:.5;cursor:not-allowed}
</style>
</head>
<body>

<div class="container">
<form id="orderForm">
  <h2>Submit Payment Details</h2>
  <input type="text" id="product" readonly>
  <input type="text" id="utr" placeholder="Payment UTR / Transaction ID" required>
  <input type="text" id="uid" placeholder="Guild UID (Example: 100200300)" required>
  <select id="region"><option value="India">üáÆüá≥ India</option><option value="Other">üåç Other</option></select>
  <input type="text" id="telegram" placeholder="Telegram Username (@username)" required>
  <input type="tel" id="whatsapp" placeholder="WhatsApp Number (+91XXXXXXXXXX)" required>
  <input type="email" id="email" placeholder="Your Email Address" required>
  <button type="submit" id="submitBtn">SUBMIT ORDER</button>
</form>

<div id="successBox" style="display:none;text-align:center;color:#0ff">
  <h2>‚úÖ ORDER RECEIVED!</h2>
  <p>Payment details & Guild UID received. Admin will verify your payment.</p>
  <a href="index.html" style="color:#a855f7">‚¨Ö BACK TO HOME</a>
</div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
document.getElementById("product").value = decodeURIComponent(params.get("product")) + " - ‚Çπ" + params.get("price");

document.getElementById("orderForm").addEventListener("submit", async function(e){
  e.preventDefault();
  const data = {
    product: decodeURIComponent(params.get("product")),
    price: params.get("price"),
    utr: document.getElementById("utr").value,
    uid: document.getElementById("uid").value,
    region: document.getElementById("region").value,
    telegram: document.getElementById("telegram").value,
    whatsapp: document.getElementById("whatsapp").value,
    email: document.getElementById("email").value
  };

  // SAVE TO SUPABASE
  await supabase.from("orders").insert([data]);

  // SEND EMAIL
  await emailjs.send("service_sd0ge44","template_eclz1lh",data); // Admin
  await emailjs.send("service_sd0ge44","customer_reply",data); // Customer

  document.getElementById("orderForm").style.display="none";
  document.getElementById("successBox").style.display="block";
});
</script>

</body>
</html>
