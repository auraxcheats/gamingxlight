<script>
// ===== URL PARAMS =====
const params = new URLSearchParams(window.location.search);
const product = params.get("product");
const price = params.get("price");

if(!product || !price){
  alert("Invalid access!");
  location.href="index.html";
}
document.getElementById("product").value =
  decodeURIComponent(product) + " - â‚¹" + price;

// ===== TELEGRAM CONFIG =====
const BOT_TOKEN = "8282483005:AAG7BXK-T7EcXWIi_rTcWvNBbCCBTW2syOA";
const CHAT_ID = "6748687420";

// ===== SUBMIT HANDLER =====
document.getElementById("orderForm").addEventListener("submit", async e=>{
  e.preventDefault();

  const btn = document.getElementById("submitBtn");
  btn.disabled = true;
  btn.innerText = "PLEASE WAIT...";

  const orderId = "GX-" + Date.now();

  const data = {
    order_id: orderId,
    product: decodeURIComponent(product),
    price: price,
    utr: utr.value,
    uid: uid.value,
    region: region.value,
    telegram: telegram.value,
    whatsapp: whatsapp.value,
    email: email.value
  };

  try{
    // âœ… TELEGRAM MESSAGE
    const message = `
ğŸ›’ NEW ORDER RECEIVED

ğŸ†” Order ID: ${orderId}
ğŸ“¦ Product: ${data.product}
ğŸ’° Price: â‚¹${data.price}

ğŸ® Guild UID: ${data.uid}
ğŸŒ Region: ${data.region}

ğŸ“± WhatsApp: ${data.whatsapp}
ğŸ’¬ Telegram: ${data.telegram}
ğŸ“§ Email: ${data.email}
`;

    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        chat_id:CHAT_ID,
        text:message
      })
    });

    // âœ… EMAIL TO CUSTOMER ONLY
    await emailjs.send(
      "service_9xrns3y",
      "customer_reply",
      data
    );

    // âœ… SAVE ORDER IN LOCAL STORAGE FOR ADMIN DASHBOARD
    let allOrders = JSON.parse(localStorage.getItem("gx_orders") || "[]");
    allOrders.push({...data, status: "Pending"});
    localStorage.setItem("gx_orders", JSON.stringify(allOrders));

    orderForm.style.display="none";
    successBox.style.display="block";

  }catch(err){
    console.error(err);
    alert("âŒ Error! Try again later.");
    btn.disabled=false;
    btn.innerText="SUBMIT ORDER";
  }
});
</script>
